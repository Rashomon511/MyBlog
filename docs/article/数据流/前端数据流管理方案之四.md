---
title: å‰ç«¯æ•°æ®æµç®¡ç†æ–¹æ¡ˆä¹‹å››
---

# dvaå…¥é—¨

> å†™è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å°†è‡ªå·±å­¦ä¼šçš„çŸ¥è¯†å†è¡¨è¾¾å‡ºæ¥ï¼Œè‡ªå·±è™½ç„¶ç†è§£äº†è¿™å—çŸ¥è¯†ï¼Œä½†æ˜¯æ˜¯å¦èƒ½ç”¨è‡ªå·±çš„è¯å†è®²å‡ºæ¥ï¼Œ
é‚£åˆæ˜¯å¦å¤–ä¸€ç§å¢ƒåœ°ï¼Œåªæœ‰èƒ½è‡ªå·±è®²è¿°åæ‰ç®—å®Œæˆè½¬åŒ–ã€‚
- [ä¼ é€é—¨](https://juejin.im/post/5b920e4e6fb9a05d3827bc15)
<!-- more -->

## dvaæ˜¯ä»€ä¹ˆ

dva æ˜¯é˜¿é‡Œä½“éªŒæŠ€æœ¯éƒ¨å¼€å‘çš„ React åº”ç”¨æ¡†æ¶ï¼Œå‘½åæ˜¯æ ¹æ®å®ˆæœ›å…ˆé”‹ä¸­çš„ä»»åŠ¡D.vaè€Œæ¥ã€‚ ä¸»è¦ç”¨äºè§£å†³ç»„ä»¶ä¹‹é—´çš„é€šè¡Œé—®é¢˜ï¼Œ
åœ¨ä»¥å‰reacté¡¹ç›®ä¸­è§£å†³æ•°æ®æµé—®é¢˜ä¼šå¼•å…¥reduxï¼Œåˆç”±äºreduxæ²¡æœ‰å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥redux-sagaæˆ–redux-thunk,è¿™æ ·çš„ç¼ºç‚¹å°±æ˜¯
å¼•å…¥å¤šä¸ªåº“ï¼Œè‡´ä½¿é¡¹ç›®ç»“æ„å¤æ‚ã€‚è€Œç°åœ¨ï¼š
>dva = React-Router + Redux + Redux-saga

å°†ä¸Šé¢ä¸‰ä¸ª React å·¥å…·åº“åŒ…è£…åœ¨ä¸€èµ·ï¼Œç®€åŒ–äº† APIï¼Œè®©å¼€å‘ React åº”ç”¨æ›´åŠ æ–¹ä¾¿å’Œå¿«æ·ã€‚
- äº†è§£dvaä¹‹å‰å¯ä»¥å…ˆå»äº†è§£redux-saga.

dvaçš„æœ€ç®€ç»“æ„ï¼š
```
import dva from 'dva';
const App = () => <div>Hello dva</div>;

// åˆ›å»ºåº”ç”¨
const app = dva();
app.model(model)
// æ³¨å†Œè§†å›¾
app.router(() => <App />);
// å¯åŠ¨åº”ç”¨
app.start('#root');
```

## æ•°æ®æµå›¾
![](/img/dva/1.png)

## æ ¸å¿ƒæ¦‚å¿µ
- Stateï¼šä¸€ä¸ªå¯¹è±¡ï¼Œä¿å­˜æ•´ä¸ªåº”ç”¨çŠ¶æ€
- Viewï¼šReact ç»„ä»¶æ„æˆçš„è§†å›¾å±‚
- Actionï¼šä¸€ä¸ªå¯¹è±¡ï¼Œæè¿°äº‹ä»¶
- connect æ–¹æ³•ï¼šä¸€ä¸ªå‡½æ•°ï¼Œç»‘å®š State åˆ° View
- dispatch æ–¹æ³•ï¼šä¸€ä¸ªå‡½æ•°ï¼Œå‘é€ Action åˆ° State

### stateå’Œview

stateæ˜¯ç”¨äºæ•°æ®å­˜å‚¨ä¿å­˜å…¨å±€çŠ¶æ€ã€‚viewæ˜¯reactç»„ä»¶æ„æˆçš„UIå±‚ï¼Œå½“stateå˜åŒ–æ—¶ä¼šè§¦å‘uiå±‚è§†å›¾çš„å˜åŒ–ã€‚

### Actionå’Œdispatch

actionæ˜¯ç”¨äºæè¿°ä¸€ä¸ªäº‹ä»¶çš„ä¸€ä¸ªå¯¹è±¡
```
{
    type: 'submit-form-data',
    payload: formData
}

```
dispatchåˆ™ç”¨æ¥å‘é€Actionåˆ°State

### connect

connect æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç»‘å®š State åˆ° Viewï¼Œconnect æ–¹æ³•è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª React ç»„ä»¶ï¼Œé€šå¸¸ç§°ä¸ºå®¹å™¨ç»„ä»¶ï¼Œæ˜¯ç”¨äºç”ŸæˆStateåˆ°Propçš„æ˜ å°„

```
// ç¬¬ä¸€ç§å†™æ³•è¿™é‡Œä½¿ç”¨æ¥ä¿®é¥°å™¨@
@connect((state) => {
  return {
    dept: state.dept,
    version: state.version,
  };
})

// ç¬¬äºŒç§å†™æ³•
connect(({ state}) => ({state}))(App);

```

## Model
dvaä¸­çš„modelæ˜¯æ‰€æœ‰çš„åº”ç”¨é€»è¾‘éƒ½å®šä¹‰åœ¨é‡Œé¢

modelçš„æ —å­ğŸŒ°ï¼š

```
export default {
    namespace: 'modelName',
    state: {
      num: 0
    }ï¼Œ
    subscriptions: {
      setup({dispatch,history}){
        return history.listen(({pathname, query})=>{
          dosomething....  
        })
      }
    }
    effects: {
        *addAfter1Second({payload}, { call, put, select }) {
          yield call(delay, 1000);
          yield put({ type: 'add' , payload: 10});
          const num =  yield select(state => state.modelNmae.num);
          console.log(num)
      },
    },
    reducers: {
      add(state, action) { 
        return{
          ...state,
          num: action.payload
        }
      },
  },
}

```
modelå¯¹è±¡çš„å±æ€§ç”±namespace,state, effect,reducers,subscriptionsç»„æˆã€‚

### namespaceå’Œstate
namespaceå½“å‰ Model çš„åç§°ã€‚æ•´ä¸ªåº”ç”¨çš„ Stateï¼Œç”±å¤šä¸ªå°çš„ Model çš„ State ä»¥ namespace ä¸º key åˆæˆ,å½“åœ¨uiå±‚è§¦å‘å˜åŒ–æ—¶ï¼Œå¯ä»¥åˆ©ç”¨namespaceæ¥åŒºåˆ†è§¦å‘é‚£ä¸ªmodelçš„æ–¹æ³•ã€‚ä»è€Œæ”¹å˜state.
```
dispatch({
  type: 'modelname/add',
  payload: 10
})
```
æ•°æ®ä¿å­˜åœ¨stateï¼Œç›´æ¥å†³å®šäº†è§†å›¾å±‚çš„è¾“å‡º.

### effectså’Œreducers

effectså’Œreducerséƒ½æ˜¯actionçš„å¤„ç†å™¨ï¼Œä¸åŒçš„æ˜¯reducerså¤„ç†çš„æ˜¯åŒæ­¥çš„action,effectså¤„ç†çš„æ˜¯å¼‚æ­¥çš„action,effectsæ˜¯åŸºäº redux-sagaå®ç°ï¼Œeffectæ˜¯ä¸€ä¸ªGeneratorå‡½æ•°ï¼Œå†…éƒ¨ä½¿ç”¨yieldå…³é”®å­—ï¼Œæ ‡è¯†æ¯ä¸€æ­¥çš„æ“ä½œã€‚effectæä¾›äº†ä¾›å†…éƒ¨ä½¿ç”¨çš„ä¸‰ä¸ªæ–¹æ³•ã€‚

- call: æ‰§è¡Œå¼‚æ­¥å‡½æ•°ï¼Œä¸€èˆ¬ç”¨äºè¯·æ±‚æ•°æ®
- put: ç›¸å½“ä¸dispatchï¼Œå‘å‡ºä¸€ä¸ªaction,è§¦æ³•ä¸€ä¸ªåŒæ­¥çš„action
- select: å¯ä»¥ç”¨äºè·å–å…¨å±€çš„çŠ¶æ€state

### subscriptions

subscriptionsä¸€èˆ¬ç”¨äºç›‘å¬è·¯ç”±å˜åŒ–ï¼Œå½“æ»¡è¶³æŸäº›è¦æ±‚æ—¶ï¼Œå¯ä»¥è§¦å‘ä¸€äº›äº‹ä»¶

